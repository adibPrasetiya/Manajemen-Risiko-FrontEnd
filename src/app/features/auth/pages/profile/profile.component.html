<div class="profile-page">
  <div class="header">
    <h2>Lengkapi Profil</h2>
    <p class="sub">Isi data diri dulu sebelum masuk dashboard.</p>
  </div>

  <form class="form" [formGroup]="form" (ngSubmit)="save()">
    <div class="field">
      <label>Jabatan <span class="req">*</span></label>
      <input type="text" formControlName="jabatan" placeholder="Contoh: Manager Operasi" />
      <small class="error" *ngIf="form.controls.jabatan.touched && form.controls.jabatan.invalid">
        Jabatan wajib diisi (min. 3 karakter).
      </small>
    </div>

    <div class="field unit-wrapper">
      <label>Unit Kerja <span class="req">*</span></label>
      <input
        #unitInput
        type="text"
        formControlName="unitKerja"
        placeholder="Ketik nama unit kerja..."
        (focus)="onUnitFocus()"
        (input)="onUnitInput()"
        autocomplete="off"
      />

      <small
        class="error"
        *ngIf="form.controls.unitKerja.touched && form.controls.unitKerja.errors?.['required']"
      >
        Unit kerja wajib diisi.
      </small>

      <small
        class="error"
        *ngIf="form.controls.unitKerja.touched && form.controls.unitKerja.errors?.['notInList']"
      >
        Unit kerja harus dipilih dari daftar.
      </small>

      <div class="dropdown" *ngIf="showDropdown">
        <button
          type="button"
          class="option"
          *ngFor="let u of filteredUnitKerja"
          (click)="pickUnit(u)"
        >
          {{ u.name }} ({{ u.code }})
        </button>

        <div class="empty" *ngIf="filteredUnitKerja.length === 0">
          Tidak ada yang cocok.
        </div>
      </div>
    </div>

    <div class="field">
      <label>Nomor HP <span class="req">*</span></label>
      <input
        type="text"
        formControlName="nomorHP"
        placeholder="Contoh: 0821123456789"
        inputmode="numeric"
      />
      <small class="error" *ngIf="form.controls.nomorHP.touched && form.controls.nomorHP.invalid">
        Nomor HP wajib diisi (min. 9 digit).
      </small>
    </div>

    <div class="actions">
      <button class="btn primary" type="submit" [disabled]="loading">
        {{ loading ? 'Menyimpan...' : 'Simpan Profil' }}
      </button>
    </div>

    <p class="server-error" *ngIf="errorMsg">{{ errorMsg }}</p>
  </form>
</div>
