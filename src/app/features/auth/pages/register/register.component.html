<app-auth-layout
  title="Create Account"
  subtitle="Buat akun."
  illustrationSrc="assets/illustrations/register.svg"
  illustrationAlt="Register Illustration"
  [showIllustration]="false"

>
  <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-3">
    <!-- Full Name -->
    <div>
      <label class="text-xs font-semibold text-gray-700">Full Name</label>
      <div class="mt-1 relative">
        <i
          class="fa-solid fa-id-card absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
        ></i>
        <input
          class="w-full pl-9 pr-3 py-2 text-sm rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Enter your full name"
          formControlName="fullName"
        />
      </div>
      <p
        *ngIf="form.get('fullName')?.touched && form.get('fullName')?.invalid"
        class="text-red-500 text-xs mt-1"
      >
        Full name is required (min 3 characters).
      </p>
    </div>

    <!-- Username -->
    <div>
      <label class="text-xs font-semibold text-gray-700">Username</label>
      <div class="mt-1 relative">
        <i
          class="fa-solid fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
        ></i>
        <input
          class="w-full pl-9 pr-3 py-2 text-sm rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Choose a username"
          formControlName="username"
        />
      </div>
      <p
        *ngIf="form.get('username')?.touched && form.get('username')?.invalid"
        class="text-red-500 text-xs mt-1"
      >
        Username is required (min 3 characters).
      </p>
    </div>

    <!-- Email -->
    <div>
      <label class="text-xs font-semibold text-gray-700">Email</label>
      <div class="mt-1 relative">
        <i
          class="fa-solid fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
        ></i>
        <input
          type="email"
          class="w-full pl-9 pr-3 py-2 text-sm rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Enter your email"
          formControlName="email"
        />
      </div>
      <p
        *ngIf="form.get('email')?.touched && form.get('email')?.invalid"
        class="text-red-500 text-xs mt-1"
      >
        Please enter a valid email.
      </p>
    </div>

    <!-- Password -->
    <div>
      <label class="text-xs font-semibold text-gray-700">Password</label>

      <div class="mt-1 relative">
        <i
          class="fa-solid fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
        ></i>

        <input
          [type]="showPassword ? 'text' : 'password'"
          class="w-full pl-9 pr-11 py-2 text-sm rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Create a strong password"
          formControlName="password"
        />

        <button
          type="button"
          (click)="showPassword = !showPassword"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 text-xs"
        >
          <i
            class="fa-solid"
            [class.fa-eye]="!showPassword"
            [class.fa-eye-slash]="showPassword"
          ></i>
        </button>
      </div>

      <p
        *ngIf="form.get('password')?.touched && form.get('password')?.invalid"
        class="text-red-500 text-xs mt-1"
      >
        Password must be at least 8 characters and include an uppercase letter,
        a number, and a symbol.
      </p>

      <!-- Password Strength -->
      <div class="mt-1 scale-100 origin-top-left">
        <app-password-strength
          [password]="passwordValue()"
        ></app-password-strength>
      </div>
    </div>

    <!-- Confirm Password -->
    <div>
      <label class="text-xs font-semibold text-gray-700">Confirm Password</label>
      <div class="mt-1 relative">
        <i
          class="fa-solid fa-shield-halved absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"
        ></i>

        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          class="w-full pl-9 pr-11 py-2 text-sm rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary"
          placeholder="Confirm your password"
          formControlName="confirmPassword"
        />

        <button
          type="button"
          (click)="showConfirmPassword = !showConfirmPassword"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 text-xs"
        >
          <i
            class="fa-solid"
            [class.fa-eye]="!showConfirmPassword"
            [class.fa-eye-slash]="showConfirmPassword"
          ></i>
        </button>
      </div>

      <p *ngIf="passwordMismatch" class="text-red-500 text-xs mt-1">
        Password does not match.
      </p>
    </div>

    <!-- Privacy & Policy (required) -->
    <div class="space-y-2 pt-1">


      <p
        *ngIf="
          (form.get('acceptPrivacy')?.touched &&
            form.get('acceptPrivacy')?.invalid) ||
          (form.get('acceptPolicy')?.touched &&
            form.get('acceptPolicy')?.invalid)
        "
        class="text-red-500 text-xs"
      >
        You must accept Privacy Policy and Terms to continue.
      </p>
    </div>

    <!-- âœ… ERROR + LOADING (taruh di sini, tepat sebelum tombol submit) -->
    <div
      *ngIf="errorMsg"
      class="rounded-xl border border-red-200 bg-red-50 p-3 text-xs text-red-700 whitespace-pre-line"
    >
      {{ errorMsg }}
    </div>

    <div *ngIf="loading" class="text-xs text-gray-600">
      Memproses registrasi...
    </div>

    <!-- Submit -->
    <button
      type="submit"
      [disabled]="loading"
      class="w-full py-2 rounded-xl bg-primary text-white text-sm font-bold hover:opacity-90 transition disabled:opacity-60 disabled:cursor-not-allowed"
    >
      {{ loading ? 'Processing...' : 'Create Account' }}
    </button>

    <!-- Link -->
    <p class="text-center text-xs text-gray-600">
      Already have an account?
      <a
        routerLink="/auth/login"
        class="font-semibold text-primary hover:underline"
        >Login</a
      >
    </p>
  </form>
</app-auth-layout>
