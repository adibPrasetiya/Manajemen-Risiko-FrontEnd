<div class="unit-kerja-page">
  <div class="card">
    <div class="card-head">
      <div class="head-left">
        <span class="head-ico"><i class="fa-solid fa-building"></i></span>
        <span class="head-title">Unit Kerja</span>
      </div>

      <div class="head-right">
        <div class="search-wrap">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input
            class="search"
            [(ngModel)]="q"
            placeholder="Cari nama / kode / email..."
            (keyup.enter)="applySearch()"
          />
        </div>
        <button class="btn" type="button" (click)="applySearch()" [disabled]="loading">
          <i class="fa-solid fa-magnifying-glass"></i>
          Search
        </button>
        <button class="btn" type="button" (click)="resetSearch()" [disabled]="loading">
          <i class="fa-solid fa-rotate-right"></i>
          Reset
        </button>
      </div>
    </div>

    <div class="hint" *ngIf="loading">Loading...</div>
    <div class="hint warn" *ngIf="errorMsg">{{ errorMsg }}</div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>NAME</th>
            <th>EMAIL</th>
            <th class="th-center">TOTAL USER</th>
            <th>CREATED AT</th>
            <th class="th-actions">ACTIONS</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let u of items; trackBy: trackById">
            <td>
              <div class="cell-stack">
                <div class="primary">{{ u.name }}</div>
                <div class="sub muted">{{ u.code }}</div>
              </div>
            </td>

            <td class="muted">{{ u.email || '-' }}</td>

            <td class="td-center">{{ u._count?.profiles ?? 0 }}</td>

            <td class="muted">{{ u.createdAt | date: 'd MMM y, HH.mm' }}</td>

            <td class="td-actions">
              <button type="button" class="icon-btn" (click)="openEdit(u)" title="Edit">
                <i class="fa-solid fa-pen-to-square"></i>
              </button>

              <button
                type="button"
                class="icon-btn danger"
                (click)="openDelete(u)"
                title="Hapus/Revoke"
              >
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>

          <tr *ngIf="!loading && items.length === 0">
            <td colspan="5" class="empty">Data unit kerja tidak ditemukan.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pager" *ngIf="pagination">
      <div class="pager-left">
        Page {{ pagination.page }} / {{ pagination.totalPages }}
        <span class="dot">â€¢</span>
        Total {{ pagination.totalItems }} data
      </div>

      <div class="pager-right">
        <button
          class="pager-btn"
          type="button"
          (click)="prevPage()"
          [disabled]="loading || !pagination.hasPrevPage"
        >
          Prev
        </button>
        <button
          class="pager-btn"
          type="button"
          (click)="nextPage()"
          [disabled]="loading || !pagination.hasNextPage"
        >
          Next
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODAL: EDIT UNIT KERJA ===================== -->
<div class="modal-backdrop" *ngIf="showEditModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Ubah Unit Kerja</h3>
      <button type="button" class="icon-close" (click)="closeEdit()">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="grid-2">
        <div class="field">
          <label>Nama</label>
          <input [(ngModel)]="editModel.name" name="editName" />
        </div>

        <div class="field">
          <label>Kode</label>
          <input [(ngModel)]="editModel.code" name="editCode" />
        </div>
      </div>

      <div class="field">
        <label>Email</label>
        <input [(ngModel)]="editModel.email" name="editEmail" />
      </div>

      <small class="error" *ngIf="editError">{{ editError }}</small>

      <div class="modal-actions">
        <button type="button" class="btn secondary" (click)="closeEdit()" [disabled]="loading">
          Batal
        </button>
        <button type="button" class="btn primary" (click)="saveEdit()" [disabled]="loading">
          Simpan
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MODAL: DELETE/REVOKE ===================== -->
<div class="modal-backdrop" *ngIf="showDeleteModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Hapus Unit Kerja</h3>
      <button type="button" class="icon-close" (click)="closeDelete()">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div class="modal-body">
      <p class="confirm">
        Yakin ingin menghapus:
        <b>{{ deleteTarget?.name }}</b> ({{ deleteTarget?.code }}) ?
      </p>

      <small class="error" *ngIf="deleteError">{{ deleteError }}</small>

      <div class="modal-actions">
        <button type="button" class="btn secondary" (click)="closeDelete()" [disabled]="loading">
          Batal
        </button>
        <button type="button" class="btn danger" (click)="confirmDelete()" [disabled]="loading">
          Hapus
        </button>
      </div>
    </div>
  </div>
</div>
